{% extends 'base.html' %}
{% load static %}

{% block content %}
	<div class="col-md-10 col-md-offset-1">
		<div style="height:40px; margin-bottom: 30px">
			<div style="display: inline-block; vertical-align: middle">
				<h2>Laufende Abschlussarbeiten</h2>
			</div>	
			<div style="display: inline-block; vertical-align: middle; margin-top:12px; margin-left: 10px;">
				<a href="{% url 'find_student' %}" id="create_new_thesis">
					<span class="btn-sm btn-success glyphicon glyphicon-plus"></span>
				</a>	
			</div>
		</div>

		<table class="ui celled table">
            <form action="" method="POST">
            {% csrf_token %}
                <thead>
                    <tr>
                        <input type="hidden" name="sort" value="">
                        <th>
                            <button type="submit" name="sort" value="due_date" style="background-color: #fafafa; border: none">Abgabedatum</button>
                        </th>
                        <th>
                            <button type="submit" name="sort" value="status" style="background-color: #fafafa; border: none">Status</button>
                        </th>
                        <th>
                            <button type="submit" name="sort" value="student" style="background-color: #fafafa; border: none">Student</button>
                        </th>
                        <th>
                            <button type="submit" name="sort" value="title" style="background-color: #fafafa; border: none">Thema</button>
                        </th>
                        <th>
                            <button type="submit" name="sort" value="assessor" style="background-color: #fafafa; border: none">Zweitkorrektor</button>
                        </th>
                        <th>Dokumente</th>
                    </tr>
                    <tr>
                        <th>
                            <input type="date" name="due_date" id="due_date" value="{{ due_date }}">
                        </th>
                        <th>
                            <select name="status" id="status">
                                {% if status == "0" or status == "1" or status == "2" or status == "3" %}
                                    {% if status == "0" %}
                                        <option value="0">Angemeldet</option>
                                        <option value=""></option>
                                        <option value="1">Verlängert</option>
                                        <option value="2">Abgegeben</option>
                                        <option value="3">Benotet</option>
                                    {% endif %}
                                    {% if status == "1" %}
                                        <option value="1">Verlängert</option>
                                        <option value=""></option>
                                        <option value="0">Angemeldet</option>
                                        <option value="2">Abgegeben</option>
                                        <option value="3">Benotet</option>
                                    {% endif %}
                                    {% if status == "2" %}
                                        <option value="2">Abgegeben</option>
                                        <option value=""></option>
                                        <option value="0">Angemeldet</option>
                                        <option value="1">Verlängert</option>
                                        <option value="3">Benotet</option>
                                    {% endif %}
                                    {% if status == "3" %}
                                        <option value="3">Benotet</option>
                                        <option value=""></option>
                                        <option value="0">Angemeldet</option>
                                        <option value="1">Verlängert</option>
                                        <option value="2">Abgegeben</option>
                                    {% endif %}
                                {% else %}
                                    <option value=""></option>
                                    <option value="0">Angemeldet</option>
                                    <option value="1">Verlängert</option>
                                    <option value="2">Abgegeben</option>
                                    <option value="3">Benotet</option>
                                {% endif %}
                            </select>
                        </th>
                        <th>
                            <input type="text" name="student" id="student" placeholder="MatrNr/Name" size="10" value="{{ student }}">
                        </th>
                        <th>
                            <input type="text" name="title" id="title" placeholder="Thema" size="10" value="{{ title }}">
                        </th>
                        <th>
                            <input type="text" name="assessor" id="assessor" placeholder="Name" size="10" value="{{ assessor }}">
                        </th>
                        <th>
                            <input type="hidden" name="theses" value="{{ theses }}">
                            <input class="btn btn-primary" type="submit" value="Suchen" >
                        </th>
                    </tr>
                </thead>
			</form>
			<tbody>
					{% for thesis in theses %}
				
					<tr class="{% cycle 'row1' 'row2' %} {{thesis.is_graded|yesno:'tr-inactive,,'}}" style="height: 80px;">
						<td>{{thesis.due_date}}</td>
						<td>
							<span>{{thesis.get_status_display}}</span>
							
							{% if thesis.is_graded %}
								<span class="badge">
                                    {{ thesis.grade }}
                                    {% if thesis.assessor_grade is not None %}
                                    |
                                    {{ thesis.assessor_grade }}
                                    {% endif %}
								</span>
							{% elif thesis.is_prolonged %}
								<div style="margin-top: 10px; font-size: 16px;">
									<span class="glyphicon glyphicon-time"></span>&nbsp;
									<span>{{thesis.prolongation_date}}</span>
								</div>
							{% endif %}


						</td>
						<td>{{thesis.student}}</td>
						<td>{{thesis.title}}</td>
						{% if thesis.assessor %}
							<td>{{thesis.assessor.first_name}} {{thesis.assessor.last_name}}</td>
						{% else %}
							<td> <i>nicht festgelegt</i></td>
						{% endif %}
						
						<td rowspan="2">
							<a class="document-link" target="_blank" href="/download/application/{{thesis.surrogate_key}}">
								<span class="glyphicon glyphicon-file"></span> Anmeldung
							</a>
							<br />
							<a class="document-link" target="_blank" href="/download/prolongation/{{thesis.surrogate_key}}">
								<span class="glyphicon glyphicon-file"></span>&nbsp;Verlängerung
							</a>
                            <br />
							<a class="document-link" target="_blank" href="/download/prolong_illness/{{thesis.surrogate_key}}">
								<span class="glyphicon glyphicon-file"></span> Krankheitsfall
							</a>
							<br />
							<a class="document-link" target="_blank" href="/download/grading/{{thesis.surrogate_key}}">
								<span class="glyphicon glyphicon-file"></span>&nbsp;Bewertung
							</a>
						</td>
						
					</tr>
					
					<tr class="{% cycle 'row1' 'row2' %}">
                        <!-- actions for thesis -->

                        <td class="info-row" colspan="1"  style="border-bottom: 1px solid #ddd; border-top:0px">
                            <a href="{%  url 'change' thesis.surrogate_key|slugify %}" class="icon-link">
                                <span class="glyphicon glyphicon-pencil" title="Ändern" style="margin-left: 2px;"></span>
                            </a>
                            {% if not thesis.is_handed_in %}
                            <a href="{% url 'prolong' thesis.surrogate_key|slugify %}" class="icon-link">
                                <span class="glyphicon glyphicon-hourglass" title="Verlängern" style="margin-left: 20px;"></span>
                            </a>
                            <a href="{% url 'handin' thesis.surrogate_key|slugify %}" class="icon-link">
                                <span class="glyphicon glyphicon-envelope" title="Einreichen" style="margin-left: 20px;"></span>
                            </a>
                            {% endif %}
                            <a href="{% url 'grade' thesis.surrogate_key|slugify %}" class="icon-link">
                                <span class="glyphicon glyphicon-education" title="Benoten" style="margin-left: 20px;"></span>
                            </a>
                        </td>

                        <!-- excom status line -->
                        {% if not thesis.is_graded %}
                            <td colspan="5" style="border-bottom: 1px solid #ddd; border-top:0px">
                                {% if thesis.is_approved %}
                                        <span class="green italic">angenommen</span>
                                {% elif thesis.is_rejected %}
                                        <span class="red italic">abgelehnt:&nbsp;</span>
                                        <span class="italic">{{thesis.excom_reject_reason}}</span>
                                {% else %}
                                        <span class="italic">offen</span>
                                {% endif %}
                            </td>
                        {% endif %}
					</tr>
					{% endfor %}
			</tbody>
		</table>
	</div>

	<script type="text/javascript">
		document.body.addEventListener("keydown", function(event) {
			var plus_key = 171;
			var plus_key_numpad = 107;

			if(event.which === plus_key || event.which === plus_key_numpad) {
				document.getElementById("create_new_thesis").click();
			}
		});		
	</script>
{% endblock content %}